{% extends "base.html" %}

{% block title %}ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  - {{ report.mentee.name }}{% endblock %}

{% block content %}
<div class="row">
    <!-- å ±å‘Šå†…å®¹è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="mb-0">
                        <i class="fas fa-file-alt me-2"></i>{{ report.mentee.name }}ã®å ±å‘Šå†…å®¹
                    </h3>
                    <span class="badge bg-{{ 'success' if report.planning_stage == 'completed' else 'primary' if report.planning_stage == 'ordered' else 'warning' if report.planning_stage == 'proposal_post' else 'secondary' }} stage-badge">
                        {% if report.planning_stage == 'proposal_pre' %}ææ¡ˆå‰
                        {% elif report.planning_stage == 'proposal_post' %}ææ¡ˆæ¸ˆã¿
                        {% elif report.planning_stage == 'ordered' %}ç™ºæ³¨æ¸ˆã¿
                        {% elif report.planning_stage == 'completed' %}å®Œäº†
                        {% endif %}
                    </span>
                </div>
                <p class="mb-0 mt-2 text-light">{{ report.report_date.strftime('%Yå¹´%mæœˆ%dæ—¥') }}ã®å ±å‘Š</p>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h5><i class="fas fa-box me-2"></i>ä»£è¡¨å•†å“ç¾¤</h5>
                        <p class="text-muted">{{ report.product_group }}</p>
                    </div>
                    <div class="col-md-6">
                        <h5><i class="fas fa-star me-2"></i>è‡ªå·±è©•ä¾¡</h5>
                        <span class="badge bg-{{ 'success' if report.self_evaluation == 3 else 'warning' if report.self_evaluation == 2 else 'danger' }} evaluation-badge">
                            {{ report.self_evaluation }}/3
                        </span>
                    </div>
                </div>

                <div class="mb-4">
                    <h5><i class="fas fa-tasks me-2"></i>ä»Šé€±ã®é€²æ—</h5>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre class="mb-0">{{ report.progress_items }}</pre>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5><i class="fas fa-running me-2"></i>å®Ÿæ–½ã—ãŸè¡Œå‹•</h5>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre class="mb-0">{{ report.actions_taken }}</pre>
                        </div>
                    </div>
                </div>

                <div class="mb-4">
                    <h5><i class="fas fa-lightbulb me-2"></i>æ°—ã¥ããƒ»æ‚©ã¿</h5>
                    <div class="insight-box">
                        <pre class="mb-0">{{ report.insights_concerns }}</pre>
                    </div>
                </div>

                {% if additional_responses %}
                <div class="mb-4">
                    <h5><i class="fas fa-question-circle me-2"></i>è¿½åŠ ã®å•ã„ã‹ã‘å›ç­”</h5>
                    <div class="card">
                        <div class="card-body">
                            {% if additional_responses.time_consuming_task %}
                            <div class="mb-3">
                                <h6 class="text-primary">ä»Šé€±ã€æœ€ã‚‚æ™‚é–“ã‚’ä½¿ã£ãŸä½œæ¥­ã¯ï¼Ÿ</h6>
                                <p class="text-muted">{{ additional_responses.time_consuming_task }}</p>
                            </div>
                            {% endif %}

                            {% if additional_responses.difficult_decision %}
                            <div class="mb-3">
                                <h6 class="text-primary">ä»Šé€±ã€æœ€ã‚‚è¿·ã£ãŸåˆ¤æ–­ã¯ï¼Ÿ</h6>
                                <p class="text-muted">{{ additional_responses.difficult_decision }}</p>
                            </div>
                            {% endif %}

                            {% if additional_responses.learned_from_senior %}
                            <div class="mb-3">
                                <h6 class="text-primary">ä»Šé€±ã€å…ˆè¼©ã‹ã‚‰å­¦ã‚“ã ã“ã¨ã¯ï¼Ÿ</h6>
                                <p class="text-muted">{{ additional_responses.learned_from_senior }}</p>
                            </div>
                            {% endif %}

                            {% if additional_responses.own_decision %}
                            <div class="mb-3">
                                <h6 class="text-primary">ä»Šé€±ã€è‡ªåˆ†ã®åˆ¤æ–­ã§é€²ã‚ãŸã“ã¨ã¯ï¼Ÿ</h6>
                                <p class="text-muted">{{ additional_responses.own_decision }}</p>
                            </div>
                            {% endif %}

                            {% if additional_responses.redid_task %}
                            <div class="mb-3">
                                <h6 class="text-primary">ä»Šé€±ã€ã‚„ã‚Šç›´ã—ãŸã“ã¨ã¯ï¼Ÿ</h6>
                                <p class="text-muted">{{ additional_responses.redid_task }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="col-lg-5">
        <!-- AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ -->
        <div class="card mb-3">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-robot me-2"></i>AIãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-primary">
                    <i class="fas fa-lightbulb me-2"></i>
                    <strong>ã‚½ã‚¯ãƒ©ãƒ†ã‚¹å¼å•ç­”æ³•</strong>ã§ãƒ¡ãƒ³ãƒ†ã‚£ã®æˆé•·ã‚’ä¿ƒã™ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">åˆ†æã—ãŸã„è¦³ç‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š</label>
                    <div class="row">
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="analyzeAspect('growth')">
                                <i class="fas fa-seedling me-1"></i>æˆé•·ã®å¯èƒ½æ€§
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="analyzeAspect('challenge')">
                                <i class="fas fa-mountain me-1"></i>èª²é¡Œã¨æŒ‘æˆ¦
                            </button>
                        </div>
                        <div class="col-6">
                            <button type="button" class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="analyzeAspect('reflection')">
                                <i class="fas fa-mirror me-1"></i>æŒ¯ã‚Šè¿”ã‚Šä¿ƒé€²
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-sm w-100 mb-2" onclick="analyzeAspect('action')">
                                <i class="fas fa-rocket me-1"></i>æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="ai-suggestions" class="mb-3" style="display: none;">
                    <h6 class="text-primary">AIææ¡ˆï¼š</h6>
                    <div id="suggestion-content" class="border rounded p-3 bg-light">
                        <!-- AIææ¡ˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                    </div>
                    <div class="mt-2">
                        <button type="button" class="btn btn-sm btn-outline-success" onclick="useSuggestion()">
                            <i class="fas fa-check me-1"></i>ã“ã®ææ¡ˆã‚’ä½¿ç”¨
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="regenerateSuggestion()">
                            <i class="fas fa-redo me-1"></i>åˆ¥ã®ææ¡ˆã‚’ç”Ÿæˆ
                        </button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <h6 class="text-primary">ã‚½ã‚¯ãƒ©ãƒ†ã‚¹å¼è³ªå•ä¾‹ï¼š</h6>
                    <div id="socratic-questions" class="small text-muted">
                        <div class="mb-2">
                            <strong>ã€Œãªãœãã†æ€ã£ãŸã®ã§ã™ã‹ï¼Ÿã€</strong> - æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã®æ·±æ˜ã‚Š
                        </div>
                        <div class="mb-2">
                            <strong>ã€Œã‚‚ã—åˆ¥ã®æ–¹æ³•ãŒã‚ã£ãŸã‚‰ã©ã†ã—ã¾ã™ã‹ï¼Ÿã€</strong> - é¸æŠè‚¢ã®æ‹¡å¤§
                        </div>
                        <div class="mb-2">
                            <strong>ã€Œã“ã®çµŒé¨“ã‹ã‚‰ä½•ã‚’å­¦ã³ã¾ã—ãŸã‹ï¼Ÿã€</strong> - å­¦ç¿’ã®ä¿ƒé€²
                        </div>
                        <div class="mb-2">
                            <strong>ã€Œæ¬¡å›ã¯ã©ã®ã‚ˆã†ã«æ”¹å–„ã—ã¾ã™ã‹ï¼Ÿã€</strong> - æˆé•·ã®æ–¹å‘æ€§
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="card">
            <div class="card-header">
                <h3 class="mb-0">
                    <i class="fas fa-comment me-2"></i>ãƒ¡ãƒ³ã‚¿ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
                </h3>
            </div>
            <div class="card-body">
                <form method="POST">
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ form.comment.label(class="form-label fw-bold") }}
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            ãƒ¡ãƒ³ãƒ†ã‚£ã®æˆé•·ã‚’ä¿ƒã™ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚è©•ä¾¡ã§ã¯ãªãã€å¯¾è©±ã®ãã£ã‹ã‘ã¨ã—ã¦æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚
                        </div>
                        {{ form.comment(class="form-control", id="comment-textarea", rows="6") }}
                        {% if form.comment.errors %}
                            <div class="text-danger">
                                {% for error in form.comment.errors %}
                                    <small>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('view_report', report_id=report.id) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>æˆ»ã‚‹
                        </a>
                        {{ form.submit(class="btn btn-success") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
let currentAspect = null;
let currentSuggestion = null;

// å ±å‘Šãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const reportData = {
    menteeName: "{{ report.mentee.name }}",
    planningStage: "{{ report.planning_stage }}",
    productGroup: `{{ report.product_group|replace('\n', '\\n')|replace('"', '\\"') }}`,
    progressItems: `{{ report.progress_items|replace('\n', '\\n')|replace('"', '\\"') }}`,
    actionsTaken: `{{ report.actions_taken|replace('\n', '\\n')|replace('"', '\\"') }}`,
    insightsConcerns: `{{ report.insights_concerns|replace('\n', '\\n')|replace('"', '\\"') }}`,
    selfEvaluation: {{ report.self_evaluation }},
    additionalResponses: {{ additional_responses|tojson|safe }}
};

// è¦³ç‚¹åˆ†æ
function analyzeAspect(aspect) {
    currentAspect = aspect;
    showLoading();
    
    // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã®AI APIã®ä»£ã‚ã‚Šï¼‰
    setTimeout(() => {
        const suggestion = generateSuggestion(aspect);
        displaySuggestion(suggestion);
    }, 1000);
}

// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
function showLoading() {
    document.getElementById('ai-suggestions').style.display = 'block';
    document.getElementById('suggestion-content').innerHTML = 
        '<div class="text-center"><i class="fas fa-spinner fa-spin me-2"></i>åˆ†æä¸­...</div>';
}

// ææ¡ˆç”Ÿæˆï¼ˆã‚½ã‚¯ãƒ©ãƒ†ã‚¹å¼å•ç­”æ³•ãƒ™ãƒ¼ã‚¹ï¼‰
function generateSuggestion(aspect) {
    const suggestions = {
        growth: {
            title: "æˆé•·ã®å¯èƒ½æ€§ã‚’æ¢ã‚‹",
            content: generateGrowthSuggestion(),
            questions: [
                "{{ report.mentee.name }}ã•ã‚“ã®å ±å‘Šã‹ã‚‰ã€ã©ã®ã‚ˆã†ãªæˆé•·ã®å…†ã—ãŒè¦‹ãˆã¾ã™ã‹ï¼Ÿ",
                "ä»Šå›ã®çµŒé¨“ã§ã€{{ report.mentee.name }}ã•ã‚“ãŒæœ€ã‚‚å­¦ã‚“ã ã“ã¨ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ã®å¼·ã¿ã‚’æ´»ã‹ã—ã¦ã€æ¬¡ã«æŒ‘æˆ¦ã§ãã‚‹ã“ã¨ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
            ]
        },
        challenge: {
            title: "èª²é¡Œã¨æŒ‘æˆ¦ã‚’åˆ†æ",
            content: generateChallengeSuggestion(),
            questions: [
                "{{ report.mentee.name }}ã•ã‚“ãŒç›´é¢ã—ã¦ã„ã‚‹èª²é¡Œã®æ ¹æœ¬åŸå› ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
                "ã“ã®èª²é¡Œã‚’ä¹—ã‚Šè¶Šãˆã‚‹ãŸã‚ã«ã€{{ report.mentee.name }}ã•ã‚“ã¯ã©ã®ã‚ˆã†ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ãŒæŒ‘æˆ¦ã—ãŸã„ã¨æ€ãˆã‚‹ç›®æ¨™ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
            ]
        },
        reflection: {
            title: "æŒ¯ã‚Šè¿”ã‚Šã‚’ä¿ƒé€²",
            content: generateReflectionSuggestion(),
            questions: [
                "{{ report.mentee.name }}ã•ã‚“ã«ã€ä»Šå›ã®çµŒé¨“ã‚’æŒ¯ã‚Šè¿”ã£ã¦ã‚‚ã‚‰ã†ãŸã‚ã«ã€ã©ã®ã‚ˆã†ãªè³ªå•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’æ·±ãç†è§£ã™ã‚‹ãŸã‚ã«ã€ä½•ã‚’èã‘ã°ã‚ˆã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ãŒæ°—ã¥ã„ã¦ã„ãªã„ç‚¹ã«ã¤ã„ã¦ã€ã©ã®ã‚ˆã†ã«æ°—ã¥ã‹ã›ã¾ã™ã‹ï¼Ÿ"
            ]
        },
        action: {
            title: "æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ææ¡ˆ",
            content: generateActionSuggestion(),
            questions: [
                "{{ report.mentee.name }}ã•ã‚“ã®æˆé•·ã‚’åŠ é€Ÿã•ã›ã‚‹ãŸã‚ã«ã€æ¬¡ã«å–ã‚Šçµ„ã‚€ã¹ãã“ã¨ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ãŒè‡ªä¸»çš„ã«è¡Œå‹•ã§ãã‚‹ã‚ˆã†ã«ã€ã©ã®ã‚ˆã†ãªæ”¯æ´ãŒã§ãã¾ã™ã‹ï¼Ÿ",
                "{{ report.mentee.name }}ã•ã‚“ã®ç›®æ¨™é”æˆã®ãŸã‚ã«ã€å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—ã¯ä½•ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
            ]
        }
    };
    
    return suggestions[aspect];
}

// æˆé•·ææ¡ˆã®ç”Ÿæˆ
function generateGrowthSuggestion() {
    const strengths = [];
    
    // è‡ªå·±è©•ä¾¡ã‹ã‚‰æˆé•·ãƒã‚¤ãƒ³ãƒˆã‚’åˆ†æ
    if (reportData.selfEvaluation >= 2) {
        strengths.push("å‰å‘ããªè‡ªå·±è©•ä¾¡");
    }
    
    // é€²æ—å†…å®¹ã‹ã‚‰å¼·ã¿ã‚’æŠ½å‡º
    if (reportData.progressItems.includes("å®Œäº†") || reportData.progressItems.includes("å®Ÿæ–½")) {
        strengths.push("å®Ÿè¡ŒåŠ›");
    }
    
    // æ°—ã¥ããƒ»æ‚©ã¿ã‹ã‚‰æˆé•·æ„æ¬²ã‚’åˆ†æ
    if (reportData.insightsConcerns.includes("å­¦ã³") || reportData.insightsConcerns.includes("æ°—ã¥ã")) {
        strengths.push("å­¦ç¿’æ„æ¬²");
    }
    
    let suggestion = `ã€${reportData.menteeName}ã•ã‚“ã®æˆé•·åˆ†æã€‘\n\n`;
    suggestion += `âœ… ç¢ºèªã§ããŸå¼·ã¿ï¼š\n`;
    strengths.forEach(strength => {
        suggestion += `â€¢ ${strength}\n`;
    });
    
    suggestion += `\nğŸŒ± æˆé•·ã®å¯èƒ½æ€§ï¼š\n`;
    suggestion += `â€¢ ä»Šå›ã®çµŒé¨“ã‚’æ´»ã‹ã—ã¦ã€ã‚ˆã‚Šå¤§ããªæŒ‘æˆ¦ã«å–ã‚Šçµ„ã‚ãã†ã§ã™\n`;
    suggestion += `â€¢ è‡ªå·±è©•ä¾¡ãŒé«˜ã„ã®ã§ã€è‡ªä¿¡ã‚’æŒã£ã¦æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é€²ã‚ã¾ã™\n`;
    suggestion += `â€¢ å­¦ç¿’æ„æ¬²ãŒé«˜ã„ã®ã§ã€æ–°ã—ã„ã‚¹ã‚­ãƒ«ç¿’å¾—ã«ç©æ¥µçš„ã§ã™\n\n`;
    
    suggestion += `ğŸ’¡ ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ³ãƒˆï¼š\n`;
    suggestion += `â€¢ å¼·ã¿ã‚’èªã‚ã¤ã¤ã€ã•ã‚‰ãªã‚‹æˆé•·ã®æ©Ÿä¼šã‚’æç¤ºã™ã‚‹\n`;
    suggestion += `â€¢ å…·ä½“çš„ãªæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸€ç·’ã«è€ƒãˆã‚‹\n`;
    suggestion += `â€¢ æˆåŠŸä½“é¨“ã‚’ç©ã¿é‡ã­ã‚‹ã“ã¨ã§è‡ªä¿¡ã‚’æ·±ã‚ã‚‹`;
    
    return suggestion;
}

// èª²é¡Œææ¡ˆã®ç”Ÿæˆ
function generateChallengeSuggestion() {
    let suggestion = `ã€${reportData.menteeName}ã•ã‚“ã®èª²é¡Œåˆ†æã€‘\n\n`;
    
    // è‡ªå·±è©•ä¾¡ã‹ã‚‰èª²é¡Œã‚’åˆ†æ
    if (reportData.selfEvaluation <= 2) {
        suggestion += `âš ï¸ è‡ªå·±è©•ä¾¡ãŒæ§ãˆã‚ï¼š\n`;
        suggestion += `â€¢ ã‚‚ã£ã¨è‡ªä¿¡ã‚’æŒã£ã¦è‰¯ã„æˆæœã‚’å‡ºã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™\n`;
        suggestion += `â€¢ æˆæœã‚’å®¢è¦³çš„ã«è©•ä¾¡ã™ã‚‹è¦–ç‚¹ã‚’é¤Šã†å¿…è¦ãŒã‚ã‚Šã¾ã™\n\n`;
    }
    
    // æ°—ã¥ããƒ»æ‚©ã¿ã‹ã‚‰èª²é¡Œã‚’æŠ½å‡º
    if (reportData.insightsConcerns.includes("æ‚©ã¿") || reportData.insightsConcerns.includes("å›°")) {
        suggestion += `ğŸ¤” èª²é¡Œã®å…†ã—ï¼š\n`;
        suggestion += `â€¢ æ‚©ã¿ã‚’æŠ±ãˆã¦ã„ã‚‹éƒ¨åˆ†ã«ã¤ã„ã¦ã€å…·ä½“çš„ãªè§£æ±ºç­–ã‚’ä¸€ç·’ã«è€ƒãˆã‚‹\n`;
        suggestion += `â€¢ ä¸€äººã§æŠ±ãˆè¾¼ã¾ãšã€ç›¸è«‡ã§ãã‚‹ç’°å¢ƒã‚’ä½œã‚‹\n\n`;
    }
    
    suggestion += `ğŸ’¡ ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ³ãƒˆï¼š\n`;
    suggestion += `â€¢ èª²é¡Œã‚’å¦å®šã›ãšã€ä¸€ç·’ã«è§£æ±ºç­–ã‚’è€ƒãˆã‚‹å§¿å‹¢ã‚’ç¤ºã™\n`;
    suggestion += `â€¢ å°ã•ãªæˆåŠŸä½“é¨“ã‹ã‚‰è‡ªä¿¡ã‚’ç©ã¿é‡ã­ã‚‹\n`;
    suggestion += `â€¢ é•·æœŸçš„ãªè¦–ç‚¹ã§æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹`;
    
    return suggestion;
}

// æŒ¯ã‚Šè¿”ã‚Šææ¡ˆã®ç”Ÿæˆ
function generateReflectionSuggestion() {
    let suggestion = `ã€${reportData.menteeName}ã•ã‚“ã®æŒ¯ã‚Šè¿”ã‚Šä¿ƒé€²ã€‘\n\n`;
    
    suggestion += `ğŸ” æŒ¯ã‚Šè¿”ã‚Šã®ãƒã‚¤ãƒ³ãƒˆï¼š\n`;
    suggestion += `â€¢ ä»Šå›ã®çµŒé¨“ã§æœ€ã‚‚å°è±¡çš„ã ã£ãŸã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿ\n`;
    suggestion += `â€¢ ã†ã¾ãã„ã£ãŸè¦å› ã¯ä½•ã ã¨æ€ã„ã¾ã™ã‹ï¼Ÿ\n`;
    suggestion += `â€¢ æ¬¡å›åŒã˜ã‚ˆã†ãªçŠ¶æ³ã«ãªã£ãŸã‚‰ã€ã©ã†æ”¹å–„ã—ã¾ã™ã‹ï¼Ÿ\n\n`;
    
    suggestion += `ğŸ’­ æ·±æ˜ã‚Šè³ªå•ä¾‹ï¼š\n`;
    suggestion += `â€¢ ã€Œãªãœãã†æ€ã£ãŸã®ã§ã™ã‹ï¼Ÿã€- æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã®ç†è§£\n`;
    suggestion += `â€¢ ã€Œã‚‚ã—åˆ¥ã®æ–¹æ³•ãŒã‚ã£ãŸã‚‰ã©ã†ã—ã¾ã™ã‹ï¼Ÿã€- é¸æŠè‚¢ã®æ‹¡å¤§\n`;
    suggestion += `â€¢ ã€Œã“ã®çµŒé¨“ã‹ã‚‰ä½•ã‚’å­¦ã³ã¾ã—ãŸã‹ï¼Ÿã€- å­¦ç¿’ã®ä¿ƒé€²\n\n`;
    
    suggestion += `ğŸ’¡ ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ³ãƒˆï¼š\n`;
    suggestion += `â€¢ ç­”ãˆã‚’æ•™ãˆã‚‹ã®ã§ã¯ãªãã€ä¸€ç·’ã«è€ƒãˆã‚‹\n`;
    suggestion += `â€¢ ãƒ¡ãƒ³ãƒ†ã‚£è‡ªèº«ã®æ°—ã¥ãã‚’å¤§åˆ‡ã«ã™ã‚‹\n`;
    suggestion += `â€¢ ç¶™ç¶šçš„ãªæŒ¯ã‚Šè¿”ã‚Šã®ç¿’æ…£ã‚’èº«ã«ã¤ã‘ã‚‹`;
    
    return suggestion;
}

// ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆã®ç”Ÿæˆ
function generateActionSuggestion() {
    let suggestion = `ã€${reportData.menteeName}ã•ã‚“ã®æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€‘\n\n`;
    
    suggestion += `ğŸš€ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š\n`;
    suggestion += `â€¢ ä»Šå›ã®å­¦ã³ã‚’æ´»ã‹ã—ãŸå…·ä½“çš„ãªæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’è¨­å®š\n`;
    suggestion += `â€¢ çŸ­æœŸãƒ»ä¸­æœŸãƒ»é•·æœŸã®ç›®æ¨™ã‚’æ˜ç¢ºã«ã™ã‚‹\n`;
    suggestion += `â€¢ å®šæœŸçš„ãªé€²æ—ç¢ºèªã®ä»•çµ„ã¿ã‚’ä½œã‚‹\n\n`;
    
    suggestion += `ğŸ“‹ å…·ä½“çš„ãªææ¡ˆï¼š\n`;
    suggestion += `â€¢ æ¥é€±ã®ç›®æ¨™ã‚’ä¸€ç·’ã«è¨­å®šã™ã‚‹\n`;
    suggestion += `â€¢ å¿…è¦ãªã‚¹ã‚­ãƒ«ã‚„ãƒªã‚½ãƒ¼ã‚¹ã‚’æ•´ç†ã™ã‚‹\n`;
    suggestion += `â€¢ å›°ã£ãŸæ™‚ã®ç›¸è«‡æ–¹æ³•ã‚’æ±ºã‚ã‚‹\n\n`;
    
    suggestion += `ğŸ’¡ ãƒ¡ãƒ³ã‚¿ãƒªãƒ³ã‚°ã®ãƒã‚¤ãƒ³ãƒˆï¼š\n`;
    suggestion += `â€¢ ãƒ¡ãƒ³ãƒ†ã‚£è‡ªèº«ãŒæ±ºã‚ãŸç›®æ¨™ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹\n`;
    suggestion += `â€¢ å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰å§‹ã‚ã‚‹\n`;
    suggestion += `â€¢ å®šæœŸçš„ãªæŒ¯ã‚Šè¿”ã‚Šã¨èª¿æ•´ã‚’è¡Œã†`;
    
    return suggestion;
}

// ææ¡ˆã‚’è¡¨ç¤º
function displaySuggestion(suggestion) {
    currentSuggestion = suggestion;
    
    let html = `<h6 class="text-primary">${suggestion.title}</h6>`;
    html += `<div class="mb-3"><pre style="white-space: pre-wrap; font-size: 0.9em;">${suggestion.content}</pre></div>`;
    
    if (suggestion.questions && suggestion.questions.length > 0) {
        html += `<h6 class="text-secondary">æ¨å¥¨è³ªå•ï¼š</h6>`;
        html += `<ul class="small">`;
        suggestion.questions.forEach(question => {
            html += `<li class="mb-1">${question}</li>`;
        });
        html += `</ul>`;
    }
    
    document.getElementById('suggestion-content').innerHTML = html;
}

// ææ¡ˆã‚’ä½¿ç”¨
function useSuggestion() {
    if (currentSuggestion) {
        const textarea = document.getElementById('comment-textarea');
        textarea.value = currentSuggestion.content;
        textarea.focus();
    }
}

// åˆ¥ã®ææ¡ˆã‚’ç”Ÿæˆ
function regenerateSuggestion() {
    if (currentAspect) {
        analyzeAspect(currentAspect);
    }
}
</script>
{% endblock %}
